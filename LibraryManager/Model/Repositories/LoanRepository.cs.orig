using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using LibraryManager.Model.Entities;
<<<<<<< HEAD
=======
using Microsoft.EntityFrameworkCore;
>>>>>>> origin/CRUD-Repositories-Book-User-Loan

namespace LibraryManager.Model.Repositories
{
    internal class LoanRepository : Interfaces.ILoanRepository
    {
        private readonly LibraryContext _context;
        public LoanRepository(LibraryContext context)
        {
           _context = context; 
        }
<<<<<<< HEAD
        public void Delete(Loan loan)
        {
            var loanToDelete = _context.Loans.Find(loan.Id);
            if (loanToDelete != null)
            {
                _context.Loans.Remove(loanToDelete);
            }
        }

        public IEnumerable<Loan> GetAll()
        {
            var loans = _context.Loans.ToList();
            return loans;
        }

        public Loan GetById(int id)
        {
            var loan = _context.Loans.Find(id);
            return loan;
        }

        public void Insert(Loan loan)
        {
            _context.Loans.Add(loan);
        }

        public void Save()
        {
            _context.SaveChanges();
        }

        public void Update(Loan loan)
        {
            var loanToUpdate = _context.Loans.Find(loan.Id);
            if (loanToUpdate != null)
            {
                loanToUpdate.TakeDate = loan.TakeDate;
                loanToUpdate.ReturnDate = loan.ReturnDate;
                loanToUpdate.BookId = loan.BookId;
                loanToUpdate.UserId = loan.UserId;
                _context.SaveChanges();
=======

        public async Task DeleteAsync(Loan loan)
        {
            var loanToDelete = await _context.Loans.FindAsync(loan.Id);
            if (loanToDelete != null)
            {
                _context.Loans.Remove(loanToDelete);
                await SaveAsync();
            }
        }

        public async Task<IEnumerable<Loan>> GetAllAsync()
        {
            return await _context.Loans.ToListAsync();
        }

        public async Task<Loan?> GetByIdAsync(int id)
        {
            return await _context.Loans.FindAsync(id);
        }

        public async Task InsertAsync(Loan loan)
        {
            await _context.Loans.AddAsync(loan);
            await SaveAsync();
        }

        public async Task SaveAsync()
        {
            await _context.SaveChangesAsync();
        }

        public async Task UpdateAsync(Loan loan)
        {
            var loanToUpdate = await _context.Loans.FindAsync(loan.Id);
            if (loanToUpdate != null)
            {
                loanToUpdate.TakeDate = loan.TakeDate;
                await SaveAsync();
>>>>>>> origin/CRUD-Repositories-Book-User-Loan
            }
        }
    }
}
